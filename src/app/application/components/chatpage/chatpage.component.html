<div>

    <div class="custom-chat-container" style="display: flex; flex-direction: column; height: 75vh;">
    <!-- Show welcome text if messages array is empty -->
    <div *ngIf="messages.length === 0" class="welcome-text" style="text-align: center; color: #c0c0c0; font-size: 20px; padding: 10px;">
        Hai, apa yang boleh saya bantu anda dengan laporan polis?
    </div>
        <!-- Messages Section -->
        <div class="messages-container" #messagesContainer style="
                flex: 1;
                overflow-y: auto;
                padding: 10px;
                border: none;
                border-radius: 10px;
                background: #f9f9f9;
                max-height: calc(100% - 30px);
        ">
            <div *ngFor="let message of messages" class="message {{ message.role }}">
                <div class="message-column">
                    <span style="white-space: pre-wrap" [innerHTML]="message.content"></span>
                </div>
            </div>
            
        </div>
        <div *ngIf="confirmButton">
            <button (click)="checkConfirm()"
                pButton
                label="Sahkan butiran laporan anda?"
                icon="pi pi-arrow-circle-right"
                class="p-button-rounded p-button-primary p-button-raised p-button-text">
            </button>
        </div>

        <p-dialog header="Pengesahan draf laporan polis" [(visible)]="visible" [modal]="true" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: 'auto' }" [draggable]="false" [resizable]="false">
            <span class="p-text-secondary block mb-8">Sahkan butiran laporan anda?</span>
            <div class="flex justify gap-2">
                <p-button label="Batal" severity="secondary" (click)="visible = false" />
                <p-button label="Sah" (click)="doneDraft()" />
            </div>
        </p-dialog>        
    
        <!-- Input Section -->
        <p-progressBar
        *ngIf="!hideProgressBar"
        mode="indeterminate"
        [style]="{
            height: '6px',
            background: 'linear-gradient(90deg, #ec7211, #0963d9)'
        }"></p-progressBar>
        <div class="input-container" style="
                display: flex;
                align-items: center;
                width: 94%;
                background-color: transparent;
                margin-top: 10px;
        ">
            <input [(ngModel)]="newMessage"
                    placeholder="Mesej..."
                    (keyup.enter)="sendMessage()"
                    style="flex: 1; padding: 10px; border-radius: 20px; font-size: 16px; border: 1px solid #ccc; outline: none;"/>
            
            <button (click)="sendMessage()"
                    pButton
                    icon="pi pi-send"
                    class="p-button-rounded p-button-primary">
            </button>
            <!--
            <button (click)="sendVoiceMessage()"
                    pButton
                    label=""
                    icon="pi pi-play"
                    style="margin-left: 10px; border-radius: 20px; width: 100px; min-width: 50px;">
            </button>-->
            <p style="margin: 3px;"></p>
            <button pButton 
                [icon]="isRecording ? 'pi pi-stop' : 'pi pi-microphone'"
                class="p-button-rounded p-button-primary"
                (click)="toggleRecording()">
            </button>
            
            <!--<p *ngIf="audioUrl">
                <strong>Playback:</strong><br />
                <audio [src]="audioUrl" controls></audio>
            </p>-->
        </div>

    </div>

    <!-- Notification Sound -->
    <audio #notificationSound src="assets/layout/styles/audio/bot-response.mp3" preload="auto"></audio>
</div>

<p-toast></p-toast>
